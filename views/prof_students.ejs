<%- include('partials/header') %>

    <div class="container-fluid">
        <div class="row">

            <!-- Nav bar section -->
            <div class="col-md-3 sidebar" style="background-color: #e9ecef; height:100vh; position:fixed; z-index : 2;">
                <div class="jumbotron text-center" style="margin-bottom: 20px;">
                    <h1 style="font-size: 5rem; font-weight: bold;">Rema.</h1>

                </div>
                <nav class="nav flex-column" style="margin:10px;">
                    <a class="btn btn-dark btn-lg" href="/prof_dashboard/students" role="button"
                        style="color: #000; font-weight:bold; margin-bottom:1%; padding:3%; background-color: #fff; border-color: #303030; border-width:2px;"
                        onmouseover="this.style.backgroundColor='#303030'; this.style.borderColor='#303030'; this.style.color='#fff';"
                        onmouseout="this.style.backgroundColor='#fff'; this.style.borderColor='#303030'; this.style.color='#000';">
                        Students
                    </a>
                    <a class="btn btn-dark btn-lg" href="/prof_dashboard/research_projects" role="button"
                        style="color:black; margin-top: 0.5%; margin-bottom:1%; padding:3%; background-color: #fff; border-color: #fff;"
                        onmouseover="this.style.backgroundColor='#303030'; this.style.borderColor='#303030'; this.style.color='#fff';"
                        onmouseout="this.style.backgroundColor='#fff'; this.style.borderColor='#fff'; this.style.color='#000';">
                        Research Projects
                    </a>
                    <a class="btn btn-dark btn-lg" href="#" role="button"
                        style="color:black; margin-top: 0.5%; margin-bottom:1%; padding:3%; background-color: #fff; border-color: #fff;"
                        onmouseover="this.style.backgroundColor='#303030'; this.style.borderColor='#303030'; this.style.color='#fff';"
                        onmouseout="this.style.backgroundColor='#fff'; this.style.borderColor='#fff'; this.style.color='#000';">
                        Under Review Papers
                    </a>
                    <a class="btn btn-dark btn-lg" href="/prof_dashboard/sponsored_projects" role="button"
                        style="color:black; margin-top: 0.5%; margin-bottom:1%; padding:3%; background-color: #fff; border-color: #fff;"
                        onmouseover="this.style.backgroundColor='#303030'; this.style.borderColor='#303030'; this.style.color='#fff';"
                        onmouseout="this.style.backgroundColor='#fff'; this.style.borderColor='#fff'; this.style.color='#000';">
                        Sponsored Projects
                    </a>
                    <a class="btn btn-dark btn-lg" href="#" role="button"
                        style="color:black; margin-top: 0.5%; margin-bottom:1%; padding:3%; background-color: #fff; border-color: #ccc;"
                        onmouseover="this.style.backgroundColor='#303030'; this.style.borderColor='#303030'; this.style.color='#fff';"
                        onmouseout="this.style.backgroundColor='#fff'; this.style.borderColor='#ccc'; this.style.color='#000';">
                        Reading List
                    </a>
                    <a class="btn btn-dark btn-lg" href="/conferences" role="button"
                        style="color:black; margin-top: 0.5%; margin-bottom:1%; padding:3%; background-color: #fff; border-color: #fff;"
                        onmouseover="this.style.backgroundColor='#303030'; this.style.borderColor='#303030'; this.style.color='#fff';"
                        onmouseout="this.style.backgroundColor='#fff'; this.style.borderColor='#fff'; this.style.color='#000';">
                        Conferences
                    </a>
                    <a class="btn btn-dark btn-lg" href="/logout" role="button"
                        style="color:black; margin-top: 0.5%; margin-bottom:1%; padding:3%; background-color: #fff; border-color: #fff;"
                        onmouseover="this.style.backgroundColor='#a40000'; this.style.borderColor='#a40000'; this.style.color='#fff';"
                        onmouseout="this.style.backgroundColor='#fff'; this.style.borderColor='#fff'; this.style.color='#000';">
                        Logout
                    </a>
                </nav>


            </div>


            <div class="col-md-6"
                style="background-color: #fff; width: 100%; height: 100vh; margin-left: auto; margin-right: auto;">
                <div class="jumbotron text-center" style="margin-bottom: 20px;">
                    <h1 style="font-size: 5rem; font-weight: bold;">Rema.</h1>

                </div>

                <!-- Section for adding students -->
                <div class="search-container">
                    <input type="text" id="student-search" placeholder="Type student name..."
                        oninput="searchStudents()">
                    <div id="student-results" class="results-box"></div>
                </div>



                <div class="container" style="position: relative;">
                    <h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 20px; margin-top: 40px;">Students</h1>
                    <% if (student_details_unarchived && Array.isArray(student_details_unarchived.rows) &&
                        student_details_unarchived.rows.length> 0) { %>
                        <ul style="font-size: 1.2rem; list-style: none; padding-left: 0;">
                            <% let currentType='' ; %>
                                <% student_details_unarchived.rows.forEach(function(student) { %>
                                    <% if (student.degree !==currentType) { %>
                                        <% if (currentType !=='' ) { %>
                        </ul>
                        <% } %>
                            <li><strong>
                                    <%= student.degree %>
                                </strong>
                                <ul style="padding-left: 20px;">
                                    <% currentType=student.degree; %>
                                        <% } %>
                                            <li style="margin-bottom: 15px;">
                                                <%= student.student_name %>
                                                    <ul>
                                                        <li>Project Title: <%= student.project_title %>
                                                        </li>
                                                    </ul>
                                                    <div class="button-group" style="margin-top: 10px;">
                                                        <button class="btn btn-warning archive_student_button"
                                                            data-student-id="<%= student.student_id %>">Archive</button>
                                                        <button class="btn btn-danger delete_student_button"
                                                            data-student-id="<%= student.student_id %>">Delete</button>
                                                    </div>
                                            </li>
                                            <% }); %>
                                </ul>
                            </li>
                            </ul>
                            <% } else { %>
                                <p>No students found.</p>
                                <% } %>
                </div>

                <div class="container" style="position: relative;">
                    <h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 20px; margin-top: 40px;">Archived
                        Students</h1>
                    <% if (student_details_archived && Array.isArray(student_details_archived.rows) &&
                        student_details_archived.rows.length> 0) { %>
                        <ul style="font-size: 1.2rem; list-style: none; padding-left: 0;">
                            <% let currentType='' ; %>
                                <% student_details_archived.rows.forEach(function(student) { %>
                                    <% if (student.degree !==currentType) { %>
                                        <% if (currentType !=='' ) { %>
                        </ul>
                        <% } %>
                            <li><strong>
                                    <%= student.degree %>
                                </strong>
                                <ul style="padding-left: 20px;">
                                    <% currentType=student.degree; %>
                                        <% } %>
                                            <li style="margin-bottom: 15px;">
                                                <%= student.student_name %>
                                                    <ul>
                                                        <li>Project Title: <%= student.project_title %>
                                                        </li>
                                                    </ul>
                                                    <div class="button-group" style="margin-top: 10px;">
                                                        <button class="archive-btn archive_student_button"
                                                            data-student-id="<%= student.student_id %>">Un-Archive</button>
                                                        <button class="delete-btn delete_student_button"
                                                            data-student-id="<%= student.student_id %>">Delete</button>
                                                    </div>



                                            </li>
                                            <% }); %>
                                </ul>
                            </li>
                            </ul>
                            <% } else { %>
                                <p>No students found.</p>
                                <% } %>
                </div>


                <!-- Static Info Section -->
                <style>
                    .body {
                        font-size: 1rem;
                    }

                    .archive_student_button {
                        background-color: #696969;

                        color: #fff;
                        /* Grey color */
                        padding: 10px 15px;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        transition: background-color 0.3s;
                    }

                    .archive_student_button:hover {
                        color: #fff;
                        background-color: #696969 !important;
                        /* Darker grey on hover */
                    }

                    .delete_student_button {
                        background-color: #a40000 !important;


                        /* Custom red color */
                        color: white !important;
                        /* White text */
                        padding: 10px 15px;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        transition: background-color 0.3s;
                    }

                    .delete_student_button:hover {
                        background-color: #800000 !important;
                        /* Darker red on hover */
                    }



                    body {
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        height: 100vh;
                        /* Full viewport height */
                        background-color: #f9f9f9;
                        /* Light background for contrast */
                    }

                    .search-container {
                        position: relative;
                        /* Relative positioning for absolute child */
                        max-width: 600px;
                        /* Max width for the search bar */
                        width: 100%;
                        /* Responsive */
                    }

                    #student-search {
                        width: 100%;
                        padding: 10px 20px;
                        border-radius: 50px;
                        /* Rounded corners */
                        border: 1px solid #ccc;
                        /* Light border */
                        font-size: 1rem;
                        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                    }

                    .results-box {
                        position: absolute;
                        /* Position results box below the input */
                        top: 100%;
                        /* Align with the bottom of the input */
                        left: 0;
                        right: 0;
                        background-color: white;
                        /* White background for the results */
                        border: 1px solid #ccc;
                        /* Border around results box */
                        border-radius: 8px;
                        /* Rounded corners */
                        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                        /* Shadow for depth */
                        z-index: 1000;
                        /* Make sure it's above other content */
                        display: none;
                        /* Initially hidden */
                    }

                    .results-box button {
                        width: 100%;
                        /* Full width buttons */
                        padding: 10px;
                        border: none;
                        background: transparent;
                        /* Transparent background */
                        text-align: left;
                        /* Align text to the left */
                        cursor: pointer;
                        /* Pointer cursor on hover */
                    }

                    .results-box button:hover {
                        background-color: #f0f0f0;
                        /* Change background on hover */
                    }

                    .remove-btn {
                        cursor: pointer;
                        color: red;
                        font-weight: bold;
                        margin-left: 10px;
                    }
                </style>
                </head>
                <div>

                    <div class="col-md-3"
                        style="background-color: #e9ecef; height: 100vh; right:0; position: fixed; z-index:4;">
                        <div id="static-info">
                            <!-- Title Section -->
                            <div class="jumbotron text-center" style="margin-bottom: 20px;">
                                <h1 style="font-size: 5rem; font-weight: bold;">Rema.</h1>
                            </div>

                            <!-- Upcoming Deadlines Card -->
                            <div class="card" style="margin-bottom: 20px;">
                                <div class="card-body">
                                    <h2 class="card-title" style="font-size: 1.5rem; font-weight: bold;">Upcoming
                                        Deadlines</h2>
                                    <ul class="list-unstyled" id="deadlines-list" style="padding-left: 20px;">
                                        <li>Project Report: September 20, 2024<span class="remove-btn"
                                                onclick="removeItem(this)">x</span></li>
                                        <li>Assignment 3 Submission: September 25, 2024<span class="remove-btn"
                                                onclick="removeItem(this)">x</span></li>
                                        <li>Midterm Exam: October 5, 2024<span class="remove-btn"
                                                onclick="removeItem(this)">x</span></li>
                                        <li>Research Proposal: October 10, 2024<span class="remove-btn"
                                                onclick="removeItem(this)">x</span></li>
                                    </ul>
                                    <!-- Edit Button to Add Deadline -->
                                    <button class="btn btn-primary btn-sm" style="background-color:#808080"
                                        onclick="addDeadline()">Edit</button>
                                </div>
                            </div>

                            <!-- To-Do List Card -->
                            <div class="card">
                                <div class="card-body">
                                    <h2 class="card-title" style="font-size: 1.5rem; font-weight: bold;">To-Do List
                                    </h2>
                                    <ul class="list-unstyled" id="todo-list" style="padding-left: 20px;">
                                        <li><input type="checkbox" id="task1" name="task1">
                                            <label for="task1">Complete UDP Pinger assignment</label>
                                            <span class="remove-btn" onclick="removeItem(this)">x</span>
                                        </li>
                                        <li><input type="checkbox" id="task2" name="task2">
                                            <label for="task2">Prepare for Midterm Exam</label>
                                            <span class="remove-btn" onclick="removeItem(this)">x</span>
                                        </li>
                                        <li><input type="checkbox" id="task3" name="task3">
                                            <label for="task3">Finish Project Report Draft</label>
                                            <span class="remove-btn" onclick="removeItem(this)">x</span>
                                        </li>
                                        <li><input type="checkbox" id="task4" name="task4">
                                            <label for="task4">Read 2 Research Papers</label>
                                            <span class="remove-btn" onclick="removeItem(this)">x</span>
                                        </li>
                                    </ul>
                                    <!-- Edit Button to Add To-Do -->
                                    <button class="btn btn-primary btn-sm" style="background-color:#808080"
                                        onclick="addTodo()">Edit</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- JavaScript -->
                    <script>
                        // Archiving the student
                        document.querySelectorAll('.archive_student_button').forEach(button => {
                            button.addEventListener('click', function () {
                                const studentId = this.getAttribute('data-student-id');

                                fetch('/prof_dashboard/archive_student', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({ student_id: studentId })
                                })
                                    .then(response => {
                                        if (response.ok) {
                                            alert("Student archived successfully.");
                                            window.location.reload();
                                        } else {
                                            alert("Failed to archive student.");
                                        }
                                    })
                                    .catch(error => {
                                        console.error("Error:", error);
                                        alert("An error occurred while archiving the student.");
                                    });
                            });
                        });

                        // Deleting the student
                        document.querySelectorAll('.delete_student_button').forEach(button => {
                            button.addEventListener('click', function () {
                                const studentId = this.getAttribute('data-student-id');

                                fetch('/delete_student', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({ student_id: studentId })
                                })
                                    .then(response => {
                                        if (response.ok) {
                                            alert("Student deleted successfully.");
                                            window.location.reload();
                                        } else {
                                            alert("Failed to delete student.");
                                        }
                                    })
                                    .catch(error => {
                                        console.error("Error:", error);
                                        alert("An error occurred while deleting the student.");
                                    });
                            });
                        });


                        // Function to add a new deadline

                        async function searchStudents() {
                            const query = document.getElementById('student-search').value;

                            const resultsDiv = document.getElementById('student-results');

                            if (query.length === 0) {
                                resultsDiv.innerHTML = '';
                                resultsDiv.style.display = 'none'; // Hide results box
                                return;
                            }

                            try {
                                const response = await fetch(`/search_students?query=${encodeURIComponent(query)}`);
                                const students = await response.json();

                                displayResults(students);
                            } catch (error) {
                                console.error('Error fetching students:', error);
                            }
                        }

                        function displayResults(students) {
                            const resultsDiv = document.getElementById('student-results');
                            resultsDiv.innerHTML = ''; // Clear previous results

                            if (students.length === 0) {
                                resultsDiv.style.display = 'none'; // Hide if no results
                                return;
                            } else {
                                resultsDiv.style.display = 'block'; // Show results box
                            }

                            students.forEach(student => {
                                const button = document.createElement('button');
                                button.textContent = student.name;
                                button.className = 'student-button';
                                button.setAttribute('data-id', student.id);

                                button.addEventListener('click', () => {
                                    addStudentToProfessor(student.id);
                                });

                                resultsDiv.appendChild(button);
                            });
                        }


                        async function addStudentToProfessor(studentId) {

                            try {
                                const response = await fetch('/prof_dashboard/add_student', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({ student_id: studentId })
                                });

                                if (response.ok) {
                                    alert('Student successfully added!');
                                    window.location.reload(); // Optional: Reload the page after successful addition
                                } else {
                                    alert('Error adding student.');
                                }
                            } catch (error) {
                                console.error('Error adding student:', error);
                                alert('An error occurred.');
                            }
                        }

                        function addDeadline() {
                            let deadline = prompt("Enter the new deadline (e.g., 'New Deadline: Date'):");
                            if (deadline) {
                                const ul = document.getElementById('deadlines-list');
                                const li = document.createElement('li');
                                li.innerHTML = `${deadline}<span class="remove-btn" onclick="removeItem(this)">x</span>`;
                                ul.appendChild(li);
                            }
                        }

                        // Function to add a new To-Do item
                        function addTodo() {
                            let todo = prompt("Enter the new To-Do item:");
                            if (todo) {
                                const ul = document.getElementById('todo-list');
                                const li = document.createElement('li');
                                li.innerHTML = `<input type="checkbox"> ${todo}<span class="remove-btn" onclick="removeItem(this)">x</span>`;
                                ul.appendChild(li);
                            }
                        }

                        // Function to remove an item from the list
                        function removeItem(element) {
                            element.parentElement.remove();
                        }
                    </script>

                </div>
            </div>

            <div class="col-md-3 col-sm-3 col-3"
                style="background-color: #e9ecef; height: 100vh; right: 0; position: fixed; z-index: 10; padding: 20px;">
                <div id="static-info">
                    <!-- Title Section -->
                    <div class="jumbotron text-center" style="margin-bottom: 20px;">
                        <h1 style="font-size: 5rem; font-weight: bold;">Rema.</h1>
                    </div>

                    <!-- Upcoming Deadlines Card -->
                    <div class="card" style="margin-bottom: 20px;">
                        <div class="card-body">
                            <h2 class="card-title" style="font-size: 1.5rem; font-weight: bold;">Upcoming Deadlines</h2>
                            <ul class="list-unstyled" id="deadlines-list" style="padding-left: 20px;">
                                <li>Project Report: September 20, 2024<span class="remove-btn"
                                        onclick="removeItem(this)" style="margin-left: 10px; cursor: pointer;">x</span>
                                </li>
                                <li>Assignment 3 Submission: September 25, 2024<span class="remove-btn"
                                        onclick="removeItem(this)" style="margin-left: 10px; cursor: pointer;">x</span>
                                </li>
                                <li>Midterm Exam: October 5, 2024<span class="remove-btn" onclick="removeItem(this)"
                                        style="margin-left: 10px; cursor: pointer;">x</span></li>
                                <li>Research Proposal: October 10, 2024<span class="remove-btn"
                                        onclick="removeItem(this)" style="margin-left: 10px; cursor: pointer;">x</span>
                                </li>
                            </ul>
                            <!-- Edit Button to Add Deadline -->
                            <button class="btn btn-primary btn-sm" style="background-color: #808080;"
                                onclick="addDeadline()">Add</button>
                        </div>
                    </div>

                    <!-- To-Do List Card -->
                    <div class="card">
                        <div class="card-body">
                            <h2 class="card-title" style="font-size: 1.5rem; font-weight: bold;">To-Do List</h2>
                            <ul class="list-unstyled" id="todo-list" style="padding-left: 20px;">
                                <li>
                                    <input type="checkbox" id="task1" name="task1">
                                    <label for="task1">Complete UDP Pinger assignment</label>
                                    <span class="remove-btn" onclick="removeItem(this)"
                                        style="margin-left: 10px; cursor: pointer;">x</span>
                                </li>
                                <li>
                                    <input type="checkbox" id="task2" name="task2">
                                    <label for="task2">Prepare for Midterm Exam</label>
                                    <span class="remove-btn" onclick="removeItem(this)"
                                        style="margin-left: 10px; cursor: pointer;">x</span>
                                </li>
                                <li>
                                    <input type="checkbox" id="task3" name="task3">
                                    <label for="task3">Finish Project Report Draft</label>
                                    <span class="remove-btn" onclick="removeItem(this)"
                                        style="margin-left: 10px; cursor: pointer;">x</span>
                                </li>
                                <li>
                                    <input type="checkbox" id="task4" name="task4">
                                    <label for="task4">Read 2 Research Papers</label>
                                    <span class="remove-btn" onclick="removeItem(this)"
                                        style="margin-left: 10px; cursor: pointer;">x</span>
                                </li>
                            </ul>
                            <!-- Edit Button to Add To-Do -->
                            <button class="btn btn-primary btn-sm" style="background-color: #808080;"
                                onclick="addTodo()">Add</button>
                        </div>
                    </div>
                </div>
            </div>


            <script>
                function addDeadline() {
                    let deadline = prompt("Enter the new deadline (e.g., 'New Deadline: Date'):");
                    if (deadline) {
                        const ul = document.getElementById('deadlines-list');
                        const li = document.createElement('li');
                        li.innerHTML = `${deadline}<span class="remove-btn" onclick="removeItem(this)">x</span>`;
                        ul.appendChild(li);
                    }
                }

                // Function to add a new To-Do item
                function addTodo() {
                    let todo = prompt("Enter the new To-Do item:");
                    if (todo) {
                        const ul = document.getElementById('todo-list');
                        const li = document.createElement('li');
                        li.innerHTML = `<input type="checkbox"> ${todo}<span class="remove-btn" onclick="removeItem(this)">x</span>`;
                        ul.appendChild(li);
                    }
                }

                // Function to remove an item from the list
                function removeItem(element) {
                    element.parentElement.remove();
                }
            </script>
        </div>


    </div>
    </div>
    <%- include('partials/footer') %>