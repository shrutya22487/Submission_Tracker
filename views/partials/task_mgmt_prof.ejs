<!--Prof to do section-->
<div class="col-md-3 col-sm-3 col-3"
     style="background-color: #e9ecef; height: 100vh; right: 0; position: fixed; z-index: 10; padding: 20px;">
    <div id="static-info">
        <!-- Title Section -->
        <div class="jumbotron text-center" style="margin-bottom: 20px;">
            <h1 style="font-size: 5rem; font-weight: bold;">Rema.</h1>
        </div>

        <!-- Upcoming Deadlines Card -->
        <div class="card">
            <div class="card-body">
                <div id="deadline-list">
                    <!-- Deadlines will be appended here -->
                    <ul id="deadline-items"></ul>
                </div>

                <!-- Form to add a new deadline -->
                <div>
                    <h3>Add New Deadline</h3>
                    <form id="add-deadline-form">
                        <label for="task">Task:</label>
                        <input type="text" id="task" name="task" required><br>

                        <label for="date">Date:</label>
                        <input type="date" id="date" name="date" required><br>

                        <button type="submit">Add Deadline</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- To-Do List Card -->
        <div class="card">
            <div class="card-body">
                <div id="todo-list">
                    <!-- Todos will be appended here -->
                    <ul id="todo-items"></ul>
                </div>

                <!-- Form to add a new to-do -->
                <div>
                    <h3>Add New Todo</h3>
                    <form id="add-todo-form">
                        <label for="task">Task:</label>
                        <input type="text" id="task_todo" name="task" required><br>

                        <label for="date">Date:</label>
                        <input type="date" id="date_todo" name="date"><br>

                        <button type="submit">Add Todo</button>
                    </form>
                </div>
            </div>
        </div>


    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    ////////////////////////////// TO-DO FUNCTIONS ///////////////////////////////////
    // Fetch and display todos when the page loads
    $(document).ready(function() {
        fetchTodos();

        // AJAX request to fetch the list of todos
        function fetchTodos() {
            $.ajax({
                url: '/prof_dashboard/todo', // URL to your backend route
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    const todoList = $('#todo-items');
                    todoList.empty(); // Clear the list before appending new items

                    if (data.length > 0) {
                        data.forEach(function(todo) {
                            todoList.append(`<li id="todo-${todo.id}">
                                    Task: ${todo.task}
                                    <button class="delete-btn1" data-id="${todo.id}">Delete</button>
                                </li>`);
                        });

                        // Attach delete event handler after todos are rendered
                        attachDeleteHandlers1();
                    } else {
                        $('#todo-list').html('<p>No todos found.</p>');
                    }
                },
                error: function(error) {
                    console.error("Error fetching todos:", error);
                    $('#todo-list').html('<p>Error fetching todos. Please try again later.</p>');
                }
            });
        }

        // Function to attach delete event handlers to delete buttons
        function attachDeleteHandlers1() {
            $('.delete-btn1').on('click', function() {
                const todoId = $(this).data('id');

                if (confirm('Are you sure you want to delete this todo?')) {
                    $.ajax({
                        url: '/prof_dashboard/delete_todo',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({ todo_id: todoId }),
                        success: function(response) {
                            alert(response.message); // Show success message

                            // Remove the deleted todo from the UI
                            $(`#todo-${todoId}`).remove();
                        },
                        error: function(error) {
                            console.error("Error deleting todo:", error);
                            alert('Error deleting todo. Please try again.');
                        }
                    });
                }
            });
        }

        // AJAX request to add a new to_do
        $('#add-todo-form').submit(function(event) {
            event.preventDefault(); // Prevent the form from submitting the default way

            const task = $('#task_todo').val();
            const date = $('#date_todo').val();

            $.ajax({
                url: '/prof_dashboard/add_todo',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ task: task }),
                success: function(response) {
                    alert(response.message); // Show success message
                    $('#task_todo').val(''); // Clear form fields
                    $('#date_todo').val('');

                    // Fetch and update the to_do list
                    fetchTodos();
                },
                error: function(error) {
                    console.error("Error adding todo:", error);
                    alert('Error adding todo. Please try again.');
                }
            });
        });
    });


    ////////////////////////////// Deadline FUNCTIONS ///////////////////////////////////

    // Fetch and display deadlines when the page loads
    $(document).ready(function() {
        fetchDeadlines();

        // AJAX request to fetch the list of deadlines
        function fetchDeadlines() {
            $.ajax({
                url: '/prof_dashboard/deadline', // URL to your backend route
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    const deadlineList = $('#deadline-items');
                    deadlineList.empty(); // Clear the list before appending new items

                    if (data.length > 0) {
                        data.forEach(function(deadline) {
                            deadlineList.append(`<li id="deadline-${deadline.id}">
                                    Task: ${deadline.task} - Due Date: ${new Date(deadline.date).toLocaleDateString()}
                                    <button class="delete-btn" data-id="${deadline.id}">Delete</button>
                                </li>`);
                        });

                        // Attach delete event handler after deadlines are rendered
                        attachDeleteHandlers();
                    } else {
                        $('#deadline-list').html('<p>No deadlines found.</p>');
                    }
                },
                error: function(error) {
                    console.error("Error fetching deadlines:", error);
                    $('#deadline-list').html('<p>Error fetching deadlines. Please try again later.</p>');
                }
            });
        }

        // Function to attach delete event handlers to delete buttons
        function attachDeleteHandlers() {
            $('.delete-btn').on('click', function() {
                const deadlineId = $(this).data('id');

                if (confirm('Are you sure you want to delete this deadline?')) {
                    $.ajax({
                        url: '/prof_dashboard/delete_deadline',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({ deadline_id: deadlineId }),
                        success: function(response) {
                            alert(response.message); // Show success message

                            // Remove the deleted deadline from the UI
                            $(`#deadline-${deadlineId}`).remove();
                        },
                        error: function(error) {
                            console.error("Error deleting deadline:", error);
                            alert('Error deleting deadline. Please try again.');
                        }
                    });
                }
            });
        }

        // AJAX request to add a new deadline
        $('#add-deadline-form').submit(function(event) {
            event.preventDefault(); // Prevent the form from submitting the default way

            const task = $('#task').val();
            const date = $('#date').val();

            $.ajax({
                url: '/prof_dashboard/add_deadline',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ task: task, date: date }),
                success: function(response) {
                    alert(response.message); // Show success message
                    $('#task').val(''); // Clear form fields
                    $('#date').val('');

                    // Fetch and update the deadline list
                    fetchDeadlines();
                },
                error: function(error) {
                    console.error("Error adding deadline:", error);
                    alert('Error adding deadline. Please try again.');
                }
            });
        });
    });
    /////////////////////////////////////////////////////////////////////////////////

</script>