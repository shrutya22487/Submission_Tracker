<%- include('partials/header') %>

<div class="container-fluid">
    <div class="row">


        <%- include('partials/nav_bar.ejs')%>

        <!-- Working console section -->
        <div class="col-md-6" style="background-color: #fff; width: 100%; height: 100vh; margin-left: auto; margin-right: auto;">
            <div id="working-console">

                <div class="jumbotron text-center" style="margin-bottom: 20px;">
                    <h1 style="font-size: 5rem; font-weight: bold;">Conferences</h1>
                </div>

                <!--Conferences-->

                <table border="1">
                    <thead>
                    <tr>
                        <th>Date</th>
                        <th>Title</th>
                        <th>Link</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="conference-table-body">
                    <% if (conferences && Array.isArray(conferences.rows)) {%>
                        <% conferences.rows.forEach(function(conference) { %>
                            <tr data-id="<%= conference.id %>">
                                <td><%= conference.date %></td>
                                <td><%= conference.title %></td>
                                <td><a href="<%= conference.link %>">Link</a></td>
                                <td>
                                    <button class="delete-btn" data-id="<%= conference.id %>">Delete</button>
                                </td>
                            </tr>
                        <% }); %>
                    <%}%>
                    </tbody>
                </table>

                <h2>Add Conference</h2>
                <form id="add-conference-form">
                    <label for="date">Date:</label>
                    <input type="date" id="date" name="date" ><br>

                    <label for="title">Title:</label>
                    <input type="text" id="title" name="title" required><br>

                    <label for="link">Link:</label>
                    <input type="url" id="link" name="link"><br>

                    <button type="submit">Add Conference</button>
                </form>
                <br>
                <br>
            </div>
        </div>

        <%- include('partials/task_mgmt_prof.ejs')%>

    </div>
</div>
<style>
    .remove-btn {
        cursor: pointer;
        color: red;
        font-weight: bold;
        margin-left: 10px;
    }
</style>

<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    ///////////////////////CONFERENCES FUNCTIONS //////////////////////////////////

    $(document).ready(function() {
        // Delete conference
        $('#conference-table-body').on('click', '.delete-btn', function() {
            const conferenceId = $(this).data('id');
            $.ajax({
                url: '/prof_dashboard/delete_conference',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ conference_id: conferenceId }),
                success: function(response) {
                    alert(response.message);
                    location.reload();
                },
                error: function(error) {
                    alert("Error deleting conference.");
                }
            });
        });

        // Add conference
        $('#add-conference-form').submit(function(e) {
            e.preventDefault();
            const formData = {
                date: $('#date').val(),
                title: $('#title').val(),
                link: $('#link').val()
            };
            $.ajax({
                url: '/prof_dashboard/add_conference',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function(response) {
                    alert(response.message);
                    location.reload();
                },
                error: function(error) {
                    alert("Error adding conference.");
                }
            });
        });
    });

    ///////////////////////////////////////////////////////////////////////////////
</script>

<%- include('partials/footer') %>
