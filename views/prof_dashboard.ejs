<%- include('partials/header') %>

<div class="jumbotron text-center" style="margin-bottom: 20px;">
    <h1 style="font-size: 5rem; font-weight: bold;">Professor Dashboard</h1>
    <a class="btn btn-dark btn-lg" href="/logout" role="button" style="position: absolute; right: 20px; top: 20px;">Logout</a>
    <a class="btn btn-dark btn-lg" href="/conferences" role="button" style="position: absolute; left: 20px; top: 20px;">Conferences</a>

</div>

<!-- Section for adding students -->
<div class="container" style="position: relative;">
    <h2 style="font-size: 2rem; font-weight: bold; margin-bottom: 20px;margin-top:40px;">Student Search</h2>
    <form id="search-form" style="margin-bottom: 20px; display: flex; justify-content: center; align-items: center;">
        <input type="text" id="search-bar" name="q" placeholder="Search" required 
               style="width: 100%; max-width: 600px; padding: 12px 20px; border: 1px solid #ccc; border-radius: 50px; font-size: 1rem; outline: none; transition: all 0.3s ease;" 
               autocomplete="off">
    </form>
    
    <div id="results" style="position: absolute; z-index: 1000; background-color: white; width: 100%; max-width: 600px; left: 50%; transform: translateX(-50%); top: 100%; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); border-radius: 10px; padding: 10px;">
        <!-- Search results will be displayed here -->
    </div>
</div>
<br>

<script>
    document.getElementById('search-bar').addEventListener('input', function() {
    const query = this.value;
    if (query.length > 0) {
        fetch(`/search?query=${query}`)
            .then(response => response.json())
            .then(data => {
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = '';
                data.forEach(student => {
                    const container = document.createElement('div');
                    container.className = 'tooltip-container';
                    
                    const button = document.createElement('button');
                    button.innerText = student.name;
                    button.style = "width: 100%; padding: 10px 15px; margin-bottom: 10px; border: none; border-radius: 10px; background-color: #f9f9f9; text-align: left; font-size: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease;";
                    
                    const tooltip = document.createElement('div');
                    tooltip.className = 'tooltip';
                    tooltip.innerText = `Add ${student.name}?`;
                    
                    container.appendChild(button);
                    container.appendChild(tooltip);
                    container.addEventListener('click', () => {
                        selectStudent(student.id);
                    });
                    resultsDiv.appendChild(container);
                });
            })
            .catch(err => console.error('Error fetching students:', err));
    } else {
        document.getElementById('results').innerHTML = '';
    }
});


    function selectStudent(student_id) {
        fetch('/prof_dashboard', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ student_id }),
        })
            .then(response => {
            if (response.ok) {
                window.location.reload(); // This triggers the page reload
            } else {
                return response.text().then(text => { throw new Error(text); });
            }
        })
            .catch(err => console.error('Error selecting student:', err));
    }
</script>





<div class="container">
    <!-- Section for students under professor -->
    <h2 style="font-size: 2rem; font-weight: bold; margin-bottom: 20px;">Students Under Professor</h2>
    <ul style="list-style-type: none; padding: 0; font-size: 1rem;">
        <% if (studentsUnderProf && studentsUnderProf.rows.length > 0) { %>
            <% studentsUnderProf.rows.forEach(student => { %>
                <li style="padding: 8px 0; border-bottom: 1px solid #ddd;">
                    <%= student.name %> - <%= student.email_id %>
                </li>
            <% }); %>
        <% } else { %>
            <li style="padding: 12px; text-align: center;">No students found.</li>
        <% } %>
    </ul>

    <!-- Table for jobs -->
    <h2 style="font-size: 2rem; font-weight: bold; margin-top: 40px; margin-bottom: 20px;">Student Jobs Data</h2>
    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
        <thead>
            <tr>
                <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">ID</th>
                <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">Title</th>
                <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">Professor Name</th>
                <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">Author</th>
                <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">Conference</th>
                <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">Status</th>
                <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">Link</th>
                <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">Date</th>
            </tr>
        </thead>
        <tbody>
            <% if (Jobs && Array.isArray(Jobs.rows) && Jobs.rows.length> 0) { %>
                <% Jobs.rows.forEach(job => { %>
                    <tr>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; font-size: 1rem;"><%= job.id %></td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; font-size: 1rem;"><%= job.title %></td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; font-size: 1rem;"><%= job.prof_name %></td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; font-size: 1rem;"><%= job.author %></td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; font-size: 1rem;"><%= job.conference %></td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; font-size: 1rem;"><%= job.status %></td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; font-size: 1rem;">
                            <a href="<%= job.link %>" style="color: #007bff; text-decoration: none;">Link</a>
                        </td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; font-size: 0.875rem; width: 150px; white-space: nowrap;">
                            <%= job.date ? job.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }).split(',').join(' ') : '' %>
                            <br>
                            <%= job.date ? job.date.getFullYear() : '' %>
                        </td>
                    </tr>
                <% }); %>
            <% } else { %>
                <tr>
                    <td colspan="8" style="text-align: center; padding: 12px; font-size: 0.875rem;">No jobs found.</td>
                </tr>
            <% } %>
        </tbody>
    </table>
</div>




<br>
<br>
<br>

<%- include('partials/footer') %>
