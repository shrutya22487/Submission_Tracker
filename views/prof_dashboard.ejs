<%- include('partials/header') %>

<h1>Professor Dashboard</h1>

<!--for student jobs data-->
<!--TODO show jobs here -->

<h2>Students Under Professor</h2>
<ul>
    <%if (studentsUnderProf && studentsUnderProf.rows.length > 0) { %>
        <% studentsUnderProf.rows.forEach(student => { %>
            <li><%= student.name %> - <%= student.email_id %></li>
    <% });} %>
</ul>

<div class="container">
    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
        <thead>
        <tr>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                ID</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Title</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Professor Name</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Author</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Conference</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Status</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Link</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Date</th>
        </tr>
        </thead>
        <tbody>
        <% if (Jobs && Jobs.rows.length> 0) { %>
            <% Jobs.rows.forEach(job=> { %>
                <tr>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.id %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.title %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.prof_name %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.author %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.conference %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.status %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;"><a
                                href="<%= job.link %>">
                            <%= job.link %>
                        </a></td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.date ? job.date.toDateString() : '' %>
                    </td>
                </tr>
            <% }); %>
        <% } else { %>
            <tr>
                <td colspan="9" style="text-align: center; padding: 12px;">No jobs found.</td>
            </tr>
        <% } %>
        </tbody>
    </table>
</div>

<!--adding students to the professors-->

<h2>Search for Students</h2>

<form id="search-form">
    <input type="text" id="search-bar" name="q" placeholder="Search..." required>
</form>

<div id="results">
    <!-- Search results will be displayed here -->
</div>

<script>
    document.getElementById('search-bar').addEventListener('input', function() {
        const query = this.value;
        if (query.length > 0) {
            fetch(`/search?query=${query}`)
                .then(response => response.json())
                .then(data => {
                    const resultsDiv = document.getElementById('results');
                    resultsDiv.innerHTML = '';
                    data.forEach(student => {
                        const button = document.createElement('button');
                        button.innerText = student.name;
                        button.addEventListener('click', () => {
                            selectStudent(student.id);
                        });
                        resultsDiv.appendChild(button);
                    });
                })
                .catch(err => console.error('Error fetching students:', err));
        } else {
            document.getElementById('results').innerHTML = '';
        }
    });

    function selectStudent(student_id) {
        fetch('/prof_dashboard', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ student_id }),
        })
            .then(response => {
            if (response.ok) {
                window.location.reload(); // This triggers the page reload
            } else {
                return response.text().then(text => { throw new Error(text); });
            }
        })
            .catch(err => console.error('Error selecting student:', err));
    }
</script>

<br>
<br>
<br>
<a class="btn btn-dark btn-lg" href="/logout" role="button">Logout</a>

<%- include('partials/footer') %>
