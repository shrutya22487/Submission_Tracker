<%- include('partials/header') %>

<h1>Professor Dashboard</h1>

<!--for student jobs data-->
<!--TODO show jobs here -->

<h2>Students Under Professor</h2>
<ul>
    <%if (studentsUnderProf && studentsUnderProf.rows.length > 0) { %>
        <% studentsUnderProf.rows.forEach(student => { %>
            <li><%= student.name %> - <%= student.email_id %></li>
    <% });} %>
</ul>

<div class="container">
    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
        <thead>
        <tr>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                ID</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Title</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Professor Name</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Author</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Conference</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Status</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Link</th>
            <th
                    style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd; background-color: #f2f2f2; font-weight: bold;">
                Date</th>
        </tr>
        </thead>
        <tbody>
        <% if (Jobs && Jobs.rows.length> 0) { %>
            <% Jobs.rows.forEach(job=> { %>
                <tr>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.id %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.title %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.prof_name %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.author %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.conference %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.status %>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;"><a
                                href="<%= job.link %>">
                            <%= job.link %>
                        </a></td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">
                        <%= job.date ? job.date.toDateString() : '' %>
                    </td>
                </tr>
            <% }); %>
        <% } else { %>
            <tr>
                <td colspan="9" style="text-align: center; padding: 12px;">No jobs found.</td>
            </tr>
        <% } %>
        </tbody>
    </table>
</div>

<!--adding students to the professors-->

<h2>Search for Students</h2>

<form id="search-form">
    <input type="text" id="search-query" name="q" placeholder="Search..." required>
    <button type="submit">Search</button>
</form>

<div id="results">
    <!-- Search results will be displayed here -->
</div>

<script>
    // Listen for form submission
    // Listen for form submission
    document.getElementById('search-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        const query = document.getElementById('search-query').value; // Get the search query
        fetch(`/search?q=${encodeURIComponent(query)}`) // Make a GET request to /search
            .then(response => response.json()) // Parse JSON response
            .then(data => {
                const resultsDiv = document.getElementById('results'); // Get the results div
                resultsDiv.innerHTML = ''; // Clear previous results

                if (data.length > 0) {
                    const ul = document.createElement('ul'); // Create a list for results
                    data.forEach(item => {
                        const li = document.createElement('li'); // Create list item
                        const button = document.createElement('button'); // Create button
                        button.textContent = item.name; // Set button text
                        button.dataset.id = item.id; // Store item ID in a data attribute
                        button.style.cursor = 'pointer'; // Make it look clickable
                        li.appendChild(button); // Append button to list item
                        ul.appendChild(li); // Append list item to the list
                    });
                    resultsDiv.appendChild(ul); // Append the list to the results div
                } else {
                    resultsDiv.textContent = 'No results found'; // Show no results message
                }
            })
            .catch(error => {
                console.error('Error fetching search results:', error); // Handle errors
            });
    });

</script>


<br>
<br>
<br>
<a class="btn btn-dark btn-lg" href="/logout" role="button">Logout</a>

<%- include('partials/footer') %>
